<img src="https://habrastorage.org/web/413/ebc/8cd/413ebc8cd62745ae89c51b1b38dc58c9.png" alt="КДПВ"/>
Я очень давно пользуюсь яндекс музыкой для поиска "что послушать". Чаще всего я просто хожу по похожим исполнителям приятных мне групп, однако этот метод уже давно не даёт результатов.  Какое-то время мои потребности закрывало я.радио с фильтром по жанру, но и его репертуар на удивление скуп. Решено было решать проблему глобально и вот что из этого вышло =)
<cut />


<h3>Что хотелось</h3>
Сразу замечу, что я не ставил целью узнать как и хорошо ли работают рекомендации или провести кластерный анализ. Над полученными данными можно поработать в очень разные стороны, но для моей конечной цели это не нужно.
А хотелось в первую очередь найти тех рок и металл исполнителей, о которых все знают, а я ввиду своей неопытности - нет.

Проблема ерундовая, скажете вы, возьми ТОП100 по версии какого либо издания и радуйся, но оно так не работает: все топы, что я видел, либо слишком “новомодные” и мне не по нраву, либо очень классические и я всё это уже слышал.

Вообще мои путешествия по музыке это отдельная история: смешно было лицезреть лица  друзей-металлистов, когда я им рассказывал про новых для себя <a href="https://music.yandex.ru/artist/3276">Black Sabbath</a> в контексте "<i>вы только послушайте как звучат</i>" =)

В общем решено было собрать всех рокеров и металлистов и их ссылки на похожих, посчитать входящие степени и построить свой топ. Ну и раз уж у меня есть явно сетевая структура, не визуализировать её в виде графа было выше моих сил.


<h3>Как собирал</h3>
Не раз и не два садился я за этот проект, но каждый раз интерес затухал раньше значимого результата (прямо по книжке). В этот раз я решил послушаться идеологов хакатонов и постарался напилить минимальный рабочий продукт за минимальное же время. По этой причине остановился на сборе наиболее близких мне жанров рока и метала вместо сбора всей музыки.

Сам парсинг написан на питоне и селениуме плюс Postgree для данных, поскольку под рукой был готовый проект на этом стеке. Селениум для продакшена решение конечно спорное, но у нас и не продакшен.

Для начала я собрал данные по рок исполнителям, их оказалось около шести тысяч.
Когда стал собирать ссылки на похожих оказалось, что рокеров на самом деле сильно больше и только небольшая их часть представлена в индексе по жанру. Отдельно собирал поджанры (русские рок и другие) - они с основным индексом совсем слабо пересекаются.  С металлом сюрпризов уже не было, разве что на середине парсинга у него появились поджанры и пришлось собирать всё заново.

В общем трижды всё пересобрав я понял что всё что мог сделал и нужно рисовать.
Хотелось бы отдельно попросить не ругаться ребят из яндекса на мои паразитные запросы, пусть их было не так много - парни, всё ради науки =)


<h3>Как рисовал</h3>
Хотел я наконец отказаться от ручного рисования в пользу <a href="https://gephi.org/">Gephi</a>, чтоб только ползуночки двигать между красиво и понятно, но не срослось - небольшие графы на тысячу вершин он отлично рисует, а в десять раз больше молча отказывается. Ни ошибок ни приветов, у коллег на винде работает, а у меня белый лист =( Сделал себе зарубку к нему вернуться (и вам рекомендую) и пошёл рисовать привычными средствами.
Поднял довольно <a href="http://blog.esemi.ru/search/label/graph">старенькое сравнение</a> питонячих либ для распасовки графов и выбрал <a href="http://igraph.org/python/">Igraph</a> с FR алгоритмом за итоговую картинку и удовлетворительную производительность.


<h3>Что получилось</h3>
Немного вводных, которые могут показаться неочевидными:
<ul>
	<li>вершина - исполнитель;</li>
	<li>рёбра - ссылки на похожих;</li>
	<li>граф направленный, но стрелки увидеть можно не всегда;</li>
	<li>вес вершины - величина входящей степени (ссылки на исполнителя как похожего у других исполнителей);</li>
	<li>в легенде у большинства графов записан размеры в формате "вершины х рёбра", коэффициент кластеризации и средняя близость вершин.</li>
</ul>

Все графы построены без учёта одиночек - тех артистов, на которых никто не ссылается и которые сами ни на кого не ссылаются. Они только создают шум и не дают никакой дополнительной информации. Можно было отсечь и вершины с небольшими степенями дабы не засоряли изображение, но мне показалось я смог без этого обойтись на итоговом графе.

<h4>Метал</h4>
Начнём с поджанров. Графы небольшие, поэтому строил сразу полные.

<a href="https://habrastorage.org/web/015/7ce/90a/0157ce90ae8d488c8c3aa781e5d5978a.png" title="фолк метал"><img src="https://habrastorage.org/web/410/c1a/90c/410c1a90c12340baaceed5f53f5aeff7.png" alt="фолк метал"/></a><a href="https://habrastorage.org/web/257/2c1/f66/2572c1f66b5f4cc59abb3dfd104ffc76.png" title="прогрессив метал"><img src="https://habrastorage.org/web/8b9/365/2f4/8b93652f4c054b8a96704d39accf026e.png" alt="прогрессив метал"/></a>

<a href="https://habrastorage.org/web/7f6/c09/797/7f6c09797b314b8a8e989199adedef37.png" title="ню метал"><img src="https://habrastorage.org/web/1db/dea/120/1dbdea1201854cfb9d85f0084c241ce6.png" alt="ню метал"/></a><a href="https://habrastorage.org/web/c07/983/224/c0798322400342bf9e2cbbde28aee368.png" title="эпик метал"><img src="https://habrastorage.org/web/375/587/045/3755870455dc4802a96b3648784089d3.png" alt="эпик метал"/></a>

<a href="https://habrastorage.org/web/85d/413/f1e/85d413f1ebd343afb655fd96e2518c7a.png" title="экстрим метал"><img src="https://habrastorage.org/web/47e/87b/f5f/47e87bf5ffd944709c123c569831efc2.png" alt="экстрим метал"/></a><a href="https://habrastorage.org/web/870/2ac/6cc/8702ac6ccea5456ba5f387047bf40cfd.png" title="классика метал"><img src="https://habrastorage.org/web/42c/722/9a1/42c7229a19ef4995b96a320bb9738a98.png" alt="классика метал"/></a>

Поджанры металла на момент сбора только появились, думаю сейчас они значительно выросли.
А вот так выглядит суммарный граф метала со всеми поджанрами в двух вариантах - основной и полный.

<a href="https://habrastorage.org/web/212/756/64c/21275664cf3a48a08f0e39877e28fa89.png" title="основные исполнители метала"><img src="https://habrastorage.org/web/ab6/63a/2cc/ab663a2cc10347f4b76220f2e9641475.png" alt="основные исполнители метала"/></a><a href="https://habrastorage.org/web/eb6/40d/8ea/eb640d8eab1342fab156f0b226a14020.png" title="все исполнители метала"><img src="https://habrastorage.org/web/f96/f19/cb1/f96f19cb1e8946c58356eb59e5c682bf.png" alt="все исполнители метала"/></a>


<h4>Рок</h4>

<a href="https://habrastorage.org/web/b7c/ab7/cd2/b7cab7cd2b464349a7da65f8620243d7.png" title="украинский рок"><img src="https://habrastorage.org/web/368/615/27b/36861527b34b4dfca79b4809fc526a07.png" alt="украинский рок"/></a><a href="https://habrastorage.org/web/6b8/bdf/466/6b8bdf4661204955bd7a66ce3fe12c5a.png" title="new wave"><img src="https://habrastorage.org/web/11e/9fe/157/11e9fe15727c4e11a12ce54176203320.png" alt="new wave"/></a>

<a href="https://habrastorage.org/web/c9b/15e/19b/c9b15e19b03d4f11a46e0cadfe79eaf7.png" title="пост-рок"><img src="https://habrastorage.org/web/b35/442/4c7/b354424c7f104c3f9a9383f327abaa3c.png" alt="пост-рок"/></a><a href="https://habrastorage.org/web/24e/7b2/7cd/24e7b27cdd7f49c0bd4a8cd9168e1575.png" title="русский рок"><img src="https://habrastorage.org/web/a00/1ad/27d/a001ad27d2114dc38c0507fb0b2885ed.png" alt="русский рок"/></a>

<a href="https://habrastorage.org/web/46a/5e2/805/46a5e2805ea84b13a4e6433176732f24.png" title="рок-н-ролл"><img src="https://habrastorage.org/web/6f9/9c6/570/6f99c65702a2488a8c1890a02f97b0e2.png" alt="рок-н-ролл"/></a><a href="https://habrastorage.org/web/de3/2ac/945/de32ac9456934a41ab0cfb3db31bd049.png" title="прогрессивный рок"><img src="https://habrastorage.org/web/ce1/ab2/bc3/ce1ab2bc3c8440e4912422c94724d963.png" alt="прогрессивный рок"/></a>

Заметьте насколько прогрессив и рок-н-ролл опережают своих собратьев. Рок исполнителей вообще сильно больше металистов (25 тысяч против 8,5), возможно это особенности я.музыки или относительная молодость метала.
Суммарный граф рока со всеми поджанрами, тоже в двух вариантах.

<a href="https://habrastorage.org/web/2c4/7dd/81d/2c47dd81d64c47a6859710b1bc1cbca5.png" title="основные исполнители рока"><img src="https://habrastorage.org/web/420/8bb/d11/4208bbd1112e4b81aa53d2bc5986a5de.png" alt="основные исполнители рока"/></a><a href="https://habrastorage.org/web/7a8/b6c/999/7a8b6c999d8140b9912ca209220550bd.png" title="все исполнители рока"><img src="https://habrastorage.org/web/5a2/dc4/5e4/5a2dc45e43e746bd87bd90729ac0c2e4.png" alt="все исполнители рока"/></a>

На основном графе отлично виден маленький и гордый кластер русского рока, столь далёкий от остальных.


<h4>Пересечение рок + метал</h4>
Наконец, начнём пересекать оба жанра. Тут уже только полные графы.
<a href="ТОДО" title="пересечение рока и метала"><img src="https://habrastorage.org/web/10b/664/843/10b664843d5b479580170938aeaa2a14.png" alt="пересечение рока и метала"/></a>
Красным отмечены рок исполнители, синим - метал, фиолетовым - оба жанра одновременно (это когда исполнитель одновременно и рок и металл). В таком виде удобно смотреть насколько близки эти жанры в принципе. Издалека это выглядит конечно интересно, но мне хотелось большей наглядности.

Изменив размер каждой вершины пропорционально её входящей степени я получил наконец ту картинку, которую буду долго изучать в поисках интересного.
<a href="ТОДО" title="пересечение рока и метала"><img src="https://habrastorage.org/web/89d/8a3/808/89d8a38086484d619dfba7f3f060367d.png" alt="пересечение рока и метала"/></a>

Тут представлена конечно превьюшка, она кликабельна, за ней карта в <b>32х32 килопикселей</b> (будьте аккуратны с трафиком) с легендой для вершин весом 30 и более. В сорцах есть ссылки на более детальные варианты этой карты и на исходники со скриптами и данными (на случай если вам захочется свой вариант цвета/размера/etc).




Насколько я заметил, вопрос количества <b>л</b><i></i> в названии жанра метала янляется очень болезненным, поэтому я придерживаюсь стороны я.музыки, раз уж все данные с неё =)
